version: 2.1
jobs:
  build_and_push_image:
    docker:
      - image: circleci/python:3.8  # Choose an appropriate base image for your project

    steps:
      - checkout

      # Check Docker daemon status and start Docker service if needed
      - run:
          name: Check Docker daemon
          command: |
            sudo systemctl status docker || sudo systemctl start docker

      # Authenticate Docker using build-time secrets and build & push the image
      - run:
          name: Build and push Docker image
          command: |
            docker build -t yakengne/python_api:1.0 \
                         --build-arg DOCKERHUB_USERNAME=$DOCKERHUB_USERNAME \
                         --build-arg DOCKERHUB_TOKEN=$DOCKERHUB_TOKEN \
                         .
            docker push yakengne/python_api:1.0

workflows:
  version: 2
  build_and_push:
    jobs:
      - build_and_push_image




